create database quanlythuvien
go

create table DOCGIA(
   MADG VARCHAR(30) PRIMARY KEY,
   TEN NVARCHAR(50),
   GIOITINH NVARCHAR(10),
   CMND VARCHAR(30),
   DIACHI NVARCHAR(50),
   SODT VARCHAR(15),
   NGAYSINH DATE
)

CREATE TABLE NHANVIEN(
  MANV VARCHAR(30) PRIMARY KEY,
  TEN NVARCHAR(50),
  DIACHI NVARCHAR(50),
  SODT VARCHAR(15),
  GIOITINH NVARCHAR(10),
  NGAYSINH DATE,
  CMND VARCHAR(20)
)

CREATE TABLE TAIKHOANDG(
  TENTK VARCHAR(30) primary key,
  MADG VARCHAR(30),
   MATKHAU VARCHAR(20),
  ENCODE VARCHAR(100)

   CONSTRAINT fk_TK_MADG
   FOREIGN KEY (MADG)
   REFERENCES DOCGIA (MADG),
)

CREATE TABLE TAIKHOANNV(
  TENTK VARCHAR(30) primary key,
  MANV VARCHAR(30),
  MATKHAU VARCHAR(20),
  ENCODE VARCHAR(100)

    CONSTRAINT FK_TK_MANV
   FOREIGN KEY (MANV)
   REFERENCES NHANVIEN (MANV)
)

CREATE TABLE LOAISACH(
    MALOAISACH VARCHAR(30) PRIMARY KEY,
	TENLOAISACH NVARCHAR(50)
)

DROP TABLE SACH
CREATE TABLE SACH(
   MASACH VARCHAR(30) PRIMARY KEY,
   TENSACH NVARCHAR(50),
   MALOAISACH VARCHAR(30),
   TACGIA NVARCHAR(50),
   NAMSX INT,
   GIASACH MONEY

   CONSTRAINT fk_SACH_MALOAISACH
   FOREIGN KEY (MALOAISACH)
   REFERENCES LOAISACH (MALOAISACH)
)

drop table KHO
CREATE TABLE KHO(
   MASACH VARCHAR(30) PRIMARY KEY,
   SOLUONG INT
   
   CONSTRAINT fk_KHO_MASACH
   FOREIGN KEY (MASACH)
   REFERENCES SACH (MASACH)  
)

DROP TABLE THANHLYHUY
CREATE TABLE THANHLYHUY(
  MAPHIEU VARCHAR(30) PRIMARY KEY,
  MASACH VARCHAR(30),
  SOLUONG INT,
  NGAY DATE,
  TIEN MONEY,
  GHICHU NVARCHAR(200)

   CONSTRAINT fk_THANHLYHUY_MASACH
   FOREIGN KEY (MASACH)
   REFERENCES SACH (MASACH)
)

DROP TABLE PHIEUGIAODICH
CREATE TABLE PHIEUGIAODICH(
    MAPHIEU VARCHAR(30) PRIMARY KEY,
	MADG VARCHAR(30),
	LOAIPHIEU NVARCHAR(10),
	NGAYMUON DATE,
	NGAYTRA DATE,
	PHIPHATSINH MONEY,

	CONSTRAINT fk_PHIEUGD_MADG
   FOREIGN KEY (MADG)
   REFERENCES DOCGIA (MADG),
)

DROP TABLE PHIEUSACH
CREATE TABLE PHIEUSACH(
    MAPHIEU VARCHAR(30),
    MASACH VARCHAR(30),
	SOLUONG INT,

	 PRIMARY KEY (MAPHIEU, MASACH),

	 CONSTRAINT fk_PHIEUSACH_MAPHIEU
   FOREIGN KEY (MAPHIEU)
   REFERENCES PHIEUGIAODICH (MAPHIEU),

   CONSTRAINT fk_PHIEUSACH_MASACH
   FOREIGN KEY (MASACH)
   REFERENCES SACH (MASACH),
)


DROP TABLE PHAT
CREATE TABLE PHAT(
  MADG VARCHAR(30) PRIMARY KEY,
 
  NGAY DATE,
  GHICHU NVARCHAR(200),

   CONSTRAINT fk_PHAT_MADG
   FOREIGN KEY (MADG)
   REFERENCES DOCGIA (MADG)

)



INSERT INTO DOCGIA VALUES('DG0001',N'Phan Thị Mai',N'Nữ','123456789', 
'Q1','0168123456','1998-06-10')
INSERT INTO DOCGIA VALUES('DG0002',N'Phan Thị Na',N'Nữ','2142154512', 
'Q2','0369852147','1998-04-10')
INSERT INTO DOCGIA VALUES('DG0003',N'Phan Thị Minh',N'Nữ','12368724', 
'Q2','036521456','1998-02-15')
INSERT INTO DOCGIA VALUES('DG0004',N'Phan Thị Hà',N'Nữ','012368547', 
'Q5','036987654','1998-12-10')
INSERT INTO DOCGIA VALUES('DG0005',N'Phan Thị Hạnh',N'Nữ','1236952365', 
'Q8','032165895','1998-10-20')


INSERT INTO NHANVIEN VALUES('NV001',N'Hoàng Văn Minh','Q6','045632568', 
'Nam','1990-06-12','45689746')

INSERT INTO NHANVIEN VALUES('NV002',N'Lê Văn Nam','Q3','215482385', 
'Nam','1989-04-02','34564665')

INSERT INTO NHANVIEN VALUES('NV003',N'Hoàng Thị Hà','Q2','0146652222', 
N'Nữ','1988-07-04','31654891')

INSERT INTO NHANVIEN VALUES('NV004',N'Lê Thị Thủy Tiên','Q7','12366655', 
N'Nữ','1991-02-08','154689798')

insert into TAIKHOANDG VALUES('docgia1','DG0001','docgia1','e5200827a72bcc766382c86b128b6f88')
insert into TAIKHOANDG VALUES('docgia2','DG0002','docgia2','e1b93616496dc083513d26946d5552ba')
insert into TAIKHOANDG VALUES('docgia3','DG0003','docgia3','f2fbac892ee58ef825283b2b233c8434')
insert into TAIKHOANDG VALUES('docgia4','DG0004','docgia4','49ad031b9ca897480df319c5bf138b19')
insert into TAIKHOANDG VALUES('docgia5','DG0005','docgia5','5c8fe29ef018656df270c13a69b55003')


insert into TAIKHOANNV VALUES('nhanvien1','NV001','thuthu1','c67f65007be553815f7f324f9071b946')
insert into TAIKHOANNV VALUES('nhanvien2','NV002','thuthu2','aeb7b124296d1fa99046b0547b5e0de8')
insert into TAIKHOANNV VALUES('nhanvien3','NV003','ketoan1','d62634cf0f87a51a6e7da25d27fdf8fc')
insert into TAIKHOANNV VALUES('nhanvien4','NV004','ketoan2','89ec5e5b11280a687eaae65b7310c7f7')



insert into LOAISACH values ('MALOAI001',N'Tên loại sách 1')
insert into LOAISACH values ('MALOAI002',N'Tên loại sách 2')
insert into LOAISACH values ('MALOAI003',N'Tên loại sách 3')
insert into LOAISACH values ('MALOAI004',N'Tên loại sách 4')


insert into SACH values('MASACH0001',N'Sách 1','MALOAI001',N'Tác giả 1', 2000,100000)

insert into SACH values('MASACH0002',N'Sách 2','MALOAI002',N'Tác giả 1', 2001,200000)

insert into SACH values('MASACH0003',N'Sách 3','MALOAI003',N'Tác giả 3', 2002,150000)
insert into SACH values('MASACH0004',N'Sách 4','MALOAI004',N'Tác giả 2', 2003,130000)
insert into SACH values('MASACH0005',N'Sách 5','MALOAI004',N'Tác giả 3', 2004,120000)
insert into SACH values('MASACH0006',N'Sách 6','MALOAI001',N'Tác giả 4', 2005,110000)


insert into KHO values('MASACH0006',4);
insert into KHO values('MASACH0005',2);
insert into KHO values('MASACH0004',3);
insert into KHO values('MASACH0003',5);
insert into KHO values('MASACH0002',3);
insert into KHO values('MASACH0001',4);


insert into THANHLYHUY values('MAPHIEU001','MASACH0001',1,'2019-05-10',100000,'GHI CHU');

insert into PHIEUGIAODICH values('MAPHIEU001','DG0001',N'Mượn','2019-05-12','2019-05-28',0);

insert into PHIEUSACH values('MAPHIEU001','MASACH0001',1);
insert into PHIEUSACH values('MAPHIEU001','MASACH0002',1);
insert into PHIEUSACH values('MAPHIEU001','MASACH0003',1);

insert into PHAT values('DG0005', '2019-05-28', N'Làm mất sách')



